import importlib.resources as ir
import pathlib
import roboticstoolbox as rtb

# 1) Locate the packaged UR3 xacro inside the roboticstoolbox package
xacro_rel = "ur_description/urdf/ur3_joint_limited_robot.urdf.xacro"
pkg = rtb.models.URDF

# 2) Materialize the resource to a real filesystem path (works even if it's in a zip/wheel)
with ir.as_file(ir.files(pkg) / xacro_rel) as xacro_path:
    print("Found xacro at:", xacro_path)

    # 3) Expand the xacro -> URDF text
    try:
        import xacro
    except ImportError:
        raise SystemExit("The 'xacro' package is not installed. Try: pip install xacro")

    # Newer xacro: process_file returns a DOM; use .toprettyxml() (fallback to .toxml())
    result = xacro.process_file(str(xacro_path))
    urdf_text = result.toprettyxml() if hasattr(result, "toprettyxml") else result.toxml()

    # 4) Write a real URDF you can read/open anywhere
    out = pathlib.Path("ur3_from_xacro.urdf")
    out.write_text(urdf_text)
    print(f"Wrote {out.resolve()} ({len(urdf_text)} bytes)")
